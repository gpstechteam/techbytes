<script>
    document.addEventListener('DOMContentLoaded', () => {
        fetch('episodes.json')
            .then(response => response.json())
            .then(data => {
                let episodes = data.episodes;
                const playerElement = document.getElementById('player');
                const sourceElement = document.getElementById('latest-episode');
                const list = document.getElementById('episode-list');

                if (episodes.length > 0) {
                    sourceElement.src = "episodes/" + episodes[0].file;
                    playerElement.load();
                    playerElement.play(); // Auto-play latest episode
                }

                // Initialize Plyr AFTER setting the src
                const plyrInstance = new Plyr(playerElement);

                episodes.forEach(episode => {
                    let li = document.createElement('li');
                    li.classList.add("list-group-item");
                    li.innerHTML = `<button class="btn btn-link episode-btn" data-src="episodes/${episode.file}">${episode.title}</button>`;
                    list.appendChild(li);
                });

                // Event delegation for better performance
                list.addEventListener('click', (event) => {
                    if (event.target.classList.contains('episode-btn')) {
                        sourceElement.src = event.target.getAttribute('data-src');
                        playerElement.load();
                        playerElement.play();
                    }
                });
            })
            .catch(error => console.error("Error loading episodes:", error));
    });
</script>
